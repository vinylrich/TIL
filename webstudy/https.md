# https

## 정의
https란 http에서 over Secure socket layer가 추가된 프로토콜로, 포트 번호는 443을 사용한다.

Secure Socket Layer는 줄여서 SSL이라고 하는데, 이는 TLS(Transport layer Socket)라고도 한다


TLS의 암호화 방식은 대칭키,비대칭키 두 방식을 섞어서 사용하는데, 두 개념을 알아보자.

## 대칭키

대칭키는 암호화 하는 키와 복호화 하는 키가 같은 경우를 말한다.

금고를 열때도 1234, 닫을때도 1234라고 생각하면 된다.

## 비대칭키

비대칭키는 암호화 하는 키와 복호화 하는 키가 다른 경우를 말한다.

비대칭키 방식은 두개의 키를 가지게 되는데 **A키로 암호화를 하면 B키로 복호화를 할 수 있고, B키로 암호화를 하면 A키로 복호화를 할 수 있도록 설계되었다.**

즉, A키로 암호화를 하면 A키로는 복호화가 안된다는 의미이다.

이 방식을 응용하면 

비공개키의 소유자는 비공개키를 이용해서 정보를 암호화 한 후에 공개키와 함께 암호화된 정보를 전송한다. 

정보와 공개키를 획득한 사람은 공개키를 이용해서 암호화된 정보를 복호화 한다.

이러면 중간에 공개키를 가로채면 데이터를 그대로 노출시켜 버릴수 있다. 하지만 상관없다. 애초에 데이터를 보호하려는 목적이 아니고, 암호화된 데이터를 가지고 공개키로 복호화 할 수 있다는 것은 

**즉 공개키와 쌍을 이루는 비공개키로 암호화 되었다는 반증이기 때문이다**. 

이를 전자서명이라 부른다.

그림으로 표현해 보자면
![image](https://user-images.githubusercontent.com/51067720/135830341-dc64614f-526a-4b4c-84f4-968929f3b56a.png)
와 같이 표현할 수 있다.

하지만 비대칭키는 대칭키에 비해 암호화,복호화 하는 과정에서 컴퓨팅 파워를 너무 많이 소모하기 때문에
SSL은 대칭키와 비대칭키 방식을 혼합해서 사용한다.

## SSL 동작 방식
실제 데이터는 대칭키 방식으로 암호화되고
대칭키를 사용하려면 서버와 클라이언트 둘 다 대칭키를 공유하고 있어야 하기 때문에 대칭키의 키는 비대칭키 방식으로 사용한다.

컴퓨터가 네트워크에서 통신을 할 때는 내부적으로 세 가지 절차가 있다.

악수->전송->세션종료

이것은 사용자에게 노출되지 않지만 클라이언트는 서버와 연결 하기 전 서버를 아직 신뢰하지 못 하기 때문에 전송 전 악수라는 과정이 필요하다.

### 전체 flow
- client가 server에 접속할 때 
1. 랜덤 데이터
2. 클라이언트가 지원하는 암호화 방식
3. 세션 아이디
이 세 가지를 보내는데

이미 세션 아이디가 있으면 악수 과정은 생략한다.

- 먼저 client는 어떤 랜덤 데이터를 생성해서 서버에 보냄
- server는 응답으로 서버측에서 생성한 랜덤 데이터와 server의 인증서를 실어 보냄
____
여기까지 절차를 악수라고 한다
- client는 비대칭키 인증 방식을 통해 브라우저에 내장된 CA들의 정보를 통해 이 인증서가 진짜인지 확인함
- CA의 인증을 받은 인증서들은 해당 CA의 개인키로 암호화가 되어 있기 때문에 만약 인증서가 진짜라면 CA의 공개키로 복호화가 가능함
- 만약 이 CA 리스트 중에 인증서가 해당하는 것이 없다면 브라우저 주소창에 NOT SECURE 표시가 뜸
- 이렇게 성공적으로 복호화된 인증서 안에는 SERVER의 공개키가 들어있음
- client는 아까 악수 할 때 생성된 server와 client의 두 무작위 데이터를 혼합해 어떤 임시키(pre master secret)를 만듦. 이 임시 키는 서버의 공개키로 암호화돼서 server로 보내짐
- server는 pre master secret을 server의 개인키로 복호화 하고 일련의 과정을 통해 master secret을 만든 후 이 master secret으로 session key를 만들어 양쪽에 동일한 대칭키가 생성되는 것
- 이제 이 대칭키는 server와 client 둘만 가지고 있으니까 이 후 서로 주고받는 데이터들은 제 3자가 알아볼 수 없음  

데이터를 주고 받는 절차를 세션이라고 하고, 데이터의 전송이 끝나면 ssl 통신이 끝났음을 알리고 session key를 폐기한다.
